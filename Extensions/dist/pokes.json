{"id":"pokes","script":"//* TITLE Pokés **//\n//* VERSION 0.3.0 **//\n//* DESCRIPTION Gotta catch them all! **//\n//* DETAILS Randomly spawns Pokémon on your dash for you to collect. **//\n//* DEVELOPER new-xkit **//\n//* FRAME false **//\n//* BETA true **//\n//* SLOW true **//\n\nXKit.extensions.pokes = {\n\trunning: false,\n\t\n\tpreferences: {\n\t\t\"catch_backgrounds\": {\n\t\t\ttext: \"Give Pokémon a background (for visibility)\",\n\t\t\tdefault: false,\n\t\t\tvalue: false\n\t\t}\n\t},\n\t\n\trun: function() {\n\t\tthis.running = true;\n\t\tXKit.tools.init_css('pokes');\n\t\tXKit.post_listener.add('pokes', XKit.extensions.pokes.checkEligibility);\n\t\tXKit.extensions.pokes.checkEligibility();\n\t},\n\n\tcheckEligibility: function() {\n\t\t$(\".post_avatar:not(.poked):not(.unpokable)\").each(function() {\n\t\t\tif (XKit.extensions.pokes.chanceGen()) {\n\t\t\t\t$(this).addClass(\"poked\");\n\t\t\t} else {\n\t\t\t\t$(this).addClass(\"unpokable\");\n\t\t\t}\n\t\t});\n\n\t\t$(\".poked:not(.poke_spawned)\").each(function() {\n\t\t\tvar pokeNr = XKit.extensions.pokes.pokeGen();\n\t\t\tXKit.extensions.pokes.fetchPoke(pokeNr, $(this));\n\t\t\t$(this).addClass(\"poke_spawned\");\n\t\t});\n\t},\n\n\tparse_pokemon: function(mdata, db_nr, pokedThing) {\n\t\tvar poke_name = mdata[db_nr].name;\n\t\tvar poke_sprite = mdata[db_nr].sprite;\n\t\tvar m_f_ratio = parseInt(mdata[db_nr].gender_rate);\n\t\tvar rarity = parseInt(mdata[db_nr].rarity);\n\n\t\tvar poke_gender = \"undefined\";\n\t\tif (m_f_ratio === -1) {\n\t\t\tpoke_gender = \"genderless\";\n\t\t} else {\n\t\t\tvar rnd_nr = Math.random();\n\t\t\tvar male_ratio = (m_f_ratio / 8);\n\t\t\tif (rnd_nr <= male_ratio) {\n\t\t\t\tpoke_gender = \"female\";\n\t\t\t} else {\n\t\t\t\tpoke_gender = \"male\";\n\t\t\t}\n\t\t}\n\n\t\tvar rarityPicker = Math.floor(Math.random() * 255);\n\t\tif (rarityPicker >= 0 && rarityPicker <= rarity) {\n\t\t\tvar poke_html;\n\t\t\tif (XKit.extensions.pokes.preferences.catch_backgrounds.value) {\n\t\t\t\tpoke_html = '<div class=\"poke poke_background\" data-pokeid=\"'+db_nr+'\" data-pokename=\"'+poke_name+'\" data-pokegender=\"'+poke_gender+'\">'+\n\t\t\t\t'<img src=\"'+poke_sprite+'\" alt=\"'+poke_name+'\"/>'+'</div>';\t\t\t\n\t\t\t} else {\n\t\t\t\tpoke_html = '<div class=\"poke\" data-pokeid=\"'+db_nr+'\" data-pokename=\"'+poke_name+'\" data-pokegender=\"'+poke_gender+'\">'+\n\t\t\t\t'<img src=\"'+poke_sprite+'\" alt=\"'+poke_name+'\"/>'+'</div>';\n\t\t\t}\n\t\t\tpokedThing.after(poke_html);\n\t\t\tpokedThing.parent().find(\".poke\").click(function(event) {\n\t\t\t\tif (XKit.storage.get(\"pokes\",\"pokemon_storage\",\"\") === \"\") {\n\t\t\t\t\tXKit.storage.set(\"pokes\",\"pokemon_storage\",\"[]\");\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tvar storage_array = JSON.parse(XKit.storage.get(\"pokes\",\"pokemon_storage\", \"\"));\n\t\t\t\t\tif (storage_array !== \"\") {\n\t\t\t\t\t\tvar poke_id = $(this).data(\"pokeid\");\n\t\t\t\t\t\tvar poke_gender = $(this).data(\"pokegender\");\n\t\t\t\t\t\tvar poke_name = $(this).data(\"pokename\");\n\t\t\t\t\t\tvar poke_wiki_name = poke_name;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (poke_name.indexOf(\" \") > -1) {\n\t\t\t\t\t\t\tvar firstWord = poke_name.split(\" \")[0];\n\t\t\t\t\t\tif (firstWord == \"Mega\" || firstWord == \"Primal\") {\n\t\t\t\t\t\t\t\tpoke_wiki_name = poke_name.split(\" \")[1];\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t} else if (firstWord == \"Cosplay\") {\n\t\t\t\t\t\t\t\tpoke_wiki_name = \"Cosplay Pikachu\";\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpoke_wiki_name = firstWord;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar old_amount = 0;\n\t\t\t\t\t\tfor (var i = 0; i < storage_array.length; i++) {\n\t\t\t\t\t\t\tif (storage_array[i].id === poke_id && storage_array[i].gender === poke_gender) {\n\t\t\t\t\t\t\t\told_amount = storage_array[i].amount;\n\t\t\t\t\t\t\t\tstorage_array.splice(i, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstorage_array.push({id: poke_id, gender: poke_gender, amount: old_amount + 1});\n\t\t\t\t\t\tXKit.storage.set(\"pokes\",\"pokemon_storage\",JSON.stringify(storage_array));\n\t\t\t\t\t\tXKit.notifications.add(\"You caught a \" + poke_gender + \" \" + poke_name.charAt(0).toUpperCase() + poke_name.substr(1) + \"!\",\"pokes\", false, function () {\n\t\t\t\t\t\t\twindow.open(\"http://bulbapedia.bulbagarden.net/wiki/\" + poke_wiki_name);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t$(this).hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tXKit.window.show(\"Catching failed!\", \"Something went wrong trying to catch the Pokémon. Please try again.<br/><br/>Error code: PKMN-001\",\"error\",\"<div class=\\\"xkit-button default\\\" id=\\\"xkit-close-message\\\">OK</div>\");\n\t\t\t\t\t}\n\t\t\t\t} catch(e) {\n\t\t\t\t\tXKit.window.show(\"Catching failed!\", \"Something went wrong trying to catch the Pokémon. Please try again.<br/><br/>Error code: PKMN-002\",\"error\",\"<div class=\\\"xkit-button default\\\" id=\\\"xkit-close-message\\\">OK</div>\");\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tXKit.extensions.pokes.parse_pokemon(mdata, XKit.extensions.pokes.pokeGen(), pokedThing);\n\t\t}\n\t},\n\n\tfetchPoke: function(db_nr, pokedThing) {\n\t\tGM_xmlhttpRequest({\n\t\t\tmethod: \"GET\",\n\t\t\turl: \"https://gist.githubusercontent.com/ThePsionic/54a1f629dba66e53aaa4/raw/pokedex.json\",\n\t\t\tjson: true,\n\t\t\tonerror: function(response) {\n\t\t\t\tconsole.log(\"Poke data could not be retrieved. Skipping instance.\");\n\t\t\t},\n\t\t\tonload: function(response) {\n\t\t\t\tvar mdata = {};\n\t\t\t\ttry {\n\t\t\t\t\tmdata = JSON.parse(response.responseText);\n\t\t\t\t\tXKit.extensions.pokes.parse_pokemon(mdata, db_nr, pokedThing);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.log(\"Poke data received was not valid JSON. Skipping instance.\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tchanceGen: function() {\n\t\tvar rnd_nr = Math.floor(Math.random() * 101);\n\t\tif (rnd_nr >= 0 && rnd_nr <= 8) {\n\t\t\treturn true;\n\t\t}\n\t\telse {\n\t\t\treturn false;\n\t\t}\n\t},\n\n\tpokeGen: function() {\n\t\treturn Math.floor(Math.random() * 889);\n\t},\n\n\tdestroy: function() {\n\t\tthis.running = false;\n\t\tXKit.post_listener.remove(\"pokes\");\n\t},\n\t\n\tcpanel: function(m_div) {\n\t\tm_div.append('<div id=\"xkit-loading_pokemon\">Loading Pokémon, please wait...</div>');\n\t\t\n\t\tGM_xmlhttpRequest({\n\t\t\tmethod: \"GET\",\n\t\t\turl: \"https://gist.githubusercontent.com/ThePsionic/54a1f629dba66e53aaa4/raw/73da44a7295f99c3cd7e29cd8012bbbe341a78d8/pokedex.json\",\n\t\t\tjson: true,\n\t\t\tonerror: function(response) {\n\t\t\t\tconsole.log(\"Poke data could not be retrieved. Not showing Pokémon.\");\n\t\t\t\t$(m_div).html(\"<div id='xkit-pokes-custom-panel'>Failed to load Pokémon Data!<br>Please refresh the page or try again later!</div>\");\n\t\t\t},\n\t\t\tonload: function(response) {\n\t\t\t\tvar mdata = {};\n\t\t\t\ttry {\n\t\t\t\t\tmdata = JSON.parse(response.responseText);\n\t\t\t\t\tvar m_html = \"<table id=\\\"xkit-pokes-custom-panel\\\" class='pokemon_display'>\";\n\t\t\t\t\tvar caught = JSON.parse(XKit.storage.get(\"pokes\",\"pokemon_storage\",\"[]\"));\n\t\t\t\t\t$.each(caught, function(index, value) {\n\t\t\t\t\t\tm_html = m_html + \"<tr class='caught' data-pokegender='\" + value.gender + \"'><td class='poke_sprite'><div><img src='\" + mdata[value.id].sprite + \"'></div></td><td class='poke_gender'><div></div></td><td class='poke_stats'><div>Name: \" + mdata[value.id].name + \"</div></td></tr>\";\n\t\t\t\t\t});\n\t\t\t\t\tm_html = m_html + \"</table>\";\n\n\t\t\t\t\t$(\"#xkit-loading_pokemon\").html(m_html);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.log(\"Poke data received was not valid JSON. Not showing Pokémon.\");\n\t\t\t\t\t$(\"#xkit-loading_pokemon\").html(\"<div id='xkit-pokes-custom-panel'>Failed to load Pokémon Data!<br>Please refresh the page or try again later!</div>\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$(\"#xkit-extensions-panel-right\").nanoScroller();\n\t\t$(\"#xkit-extensions-panel-right\").nanoScroller({ scroll: 'top' });\n\n\t}\n};\n","file":"found","server":"up","errors":false,"icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAB71BMVEXDFxTDGBXEGBXEGRbEGhfFGhfFGxjFHBnGHRnGHRrGHhvHHxzHIB3IIR7IIh/IIx/IIyDJIyDJJCHJJSLKJSLKJiLKJiPKJyPLJyTLKCXLKSbMKifMKyfMKyjNKyjNLCnNLSrOLSrOLivOLyvOLyzPMCzPMC3PMS7QMi7QMi/QMzDQNDDRNDDRNDHRNTLSNzTSODTTOTbTOjbUOjfUOzjUPDnVPTrVPjrVPjvWPzzWQDzWQD3XQT3XQT7XQj/YQ0DYREDYREHZRUHZRULZRkPaSUXbSUbbS0fcS0jcTEncTUndTkrdT0veUEzeUU7fUk/fU0/fU1DgVFDgVVHgVVLgVlLhVlLhVlPhV1PhV1TiWFXiWVXiWVbjW1fjW1jkXFnkXVnkXlrlXlvmYF3mYV3mYV7mYl7nYl/nY1/nZGDnZGHoZWHoZWLoZmLoZmPpaGXqaWXsbWnsbWrsbmvtb2ztcGztcG3tcW3vc2/vdXHwdnLwd3PxeHTxeXXye3fzfHjzfXn0f3v0gHz1gHz1gX31gn72gn72gn/2g3/2hID3hID3hIH3hYH3hoL4h4P4h4T4iIT5iYX5iob5iof6iof6i4f6jIj7jYn7jor7jov7j4v8j4v8kIz9kY39ko7+k4/+lJD+lZH/lZH/lZL/lpLzSjZ8AAACiUlEQVR4Ae3OW1cbdQAE8FmiiQQS5SIiqEREkWDUiAKiBu94UYgYMSgoKpbSQi/QS9PSFii0lEJKaUnShoQknQ/aDaGw/93N7tKX8sDvZR7mnDmDQwdc5Yc/Dh8ZH/3zO78b++b4dGKVe27+77dhH14d26Ta+uDzsKj2VI560n+VwQJbX5rFbARgqnqGRk6Wwth7cRqbq4ORri2auetBcR0Zmos1oJiWNK1Yq4S+8ju05pIEXVO0agB6umlZphFaznVaNwOtMLW2bs3Nx6mnA2plSarkznY6IKvqmaXGVaj9RJUFLx6Tvk5QrRUqixRNO6BQM0+V4xA1UnTGBoHrBkVxGwS/ULBUijypIRB4GdteS1P0LgQXqJQrtO2LlF30IK+fohCUpCSVzgmvUh9A9lyMgmkoVVLQBtlHD7kjWQPZMAVLUHoh+GsoNBAOhwf6Q8Fgrw2AtMBd45DVBkOy8G/h8O9y9v8MEw3cs4En0EkF99MYqOOeNZixN3u9vgJvy5uv2yG7zF1/QFbmaXrb+45vW6vX2wSlCgq+geyNFHesOCGbpCABJekBlWYlyPwJbluth6wiTcEVCCIUdCOv6micjA45kXeMojEIBimIVaOg2o2Cdqp8AYGPonkXBG8lKcq4ILDdo+j6K1Bou0+VCFRGqJLqc2CH6z9qfAWV+hzVYv/43c/YX+qaSFFj/VmonaaebJa6eqHhydK623ZojdK6z6DDGaVVU9Dly9CaaDn0fUtLUs0o5m9akA2gKGmUpjI9MDKUo7HNT2Ds4wSNLDfCTE2EReUmnTAnfblGfXPvwxr7D8vUmg2UwLIS/4kYlVb+bcY+2Zq+H48sRTdWr50f+fxFHGSHHgFDvilaRY1OsQAAAABJRU5ErkJggg==\n","css":".poke {\n\tposition: absolute;\n\tright: -126px;\n}\n\n.poke_background {\n\tbackground: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASBAMAAACk4JNkAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuNvyMY98AAAAhUExURf///zAwMEhQUHh4gJhIOKCgwNhYONjI8PiQOPjQOPj4+CJu/FkAAAALdFJOUwC0tLS0tLS0tLS0/fXDXAAAAH1JREFUCNdjYGBgEBQUZAADwY6ODjCTEcjoaBMAsiRmgpiJQKHOVTOArDQBJJZEB1g2LRHIAutAYYmAWWlpjgxCHk1KQEaKIoOQkupStTQnJUUGRiOtVUpKSspA86pMlwIZpUDrxBcbl5eXB4JcEA5khAqAXRUaGgpzINilAJ/TLm7LlTr9AAAAAElFTkSuQmCC) no-repeat;\n    background-size: 100px 100px;\n\timage-rendering: pixelated;\n}\n\n.poke img {\n\twidth: 100px;\n\timage-rendering: pixelated;\n}\n\n.caught img {\n\twidth: 55px;\n\timage-rendering: pixelated;\n}\n\n.poke::after {\n\tfont-size:26px;\n\tfont-weight: bold;\n\tposition: relative;\n\tleft: -26px;\n}\n\n.caught .poke_gender div::after {\n \tfont-size:26px;\n\tfont-weight:bold;\n\tposition:relative;\n\ttop:-20px;\n}\n\n.poke[data-pokegender=\"male\"]::after,\n.caught[data-pokegender=\"male\"] .poke_gender div::after {\n\tcontent: \"\\2642\";\n\tcolor: #6CA0DC;\n}\n\n.poke[data-pokegender=\"female\"]::after,\n.caught[data-pokegender=\"female\"] .poke_gender div::after {\n\tcontent: \"\\2640\";\n\tcolor: #FF69B4;\n}\n\n.poke[data-pokegender=\"genderless\"]::after,\n.caught[data-pokegender=\"genderless\"] .poke_gender div::after {\n\tcontent: \"\\26AA\";\n\tcolor: #9370DB;\n}\n\n.caught {\n\tborder-bottom: 1px solid rgb(190,190,190);\n}\n\n.caught .poke_sprite{\n\twidth: 65px;\n}\n\n.caught .poke_stats {\n\tvertical-align: middle;\n}\n\n#xkit-pokes-custom-panel {\n\twidth: 100%\n}\n\n#xkit-loading_pokemon {\n\ttext-align: center;\n\tposition: relative;\n}\n","title":"Pokés","description":"Gotta catch them all!","developer":"new-xkit","version":"0.3.0","details":"Randomly spawns Pokémon on your dash for you to collect.","frame":"false","beta":"true","slow":"true"}
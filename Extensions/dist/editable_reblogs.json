{"id":"editable_reblogs","script":"//* TITLE Editable Reblogs **//\n//* VERSION 2.0.1 **//\n//* DESCRIPTION\tRestores ability to edit previous reblogs of a post **//\n//* DEVELOPER new-xkit **//\n//* FRAME false **//\n//* BETA false **//\n\nXKit.extensions.editable_reblogs = new Object({\n\n\trunning: false,\n\n\trun: function() {\n\t\tthis.running = true;\n\n\t\tXKit.interface.post_window_listener.add(\"editable_reblogs\", XKit.extensions.editable_reblogs.post_window);\n\t\tXKit.tools.add_css(\".control-reblog-tree {display: none; }\", \"editable_reblogs_remove_content_tree\");\n\t},\n\n\tpost_window: function() {\n\t\tvar is_legacy = $(\".reblog-tree\").length > 0;\n\t\tif (is_legacy) {\n\t\t\tXKit.extensions.editable_reblogs.post_window_legacy();\n\t\t\treturn;\n\t\t}\n\t\tvar reblog_tree = $(\".post-form .reblog-list\");\n\t\tif (reblog_tree.length <= 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar all_quotes = [];\n\t\t// Guard against double evaluation by marking the tree as processed\n\t\tvar processed_class = 'xkit-editable-reblogs-done';\n\t\tif (reblog_tree.hasClass(processed_class)) {\n\t\t\treturn;\n\t\t}\n\t\treblog_tree.addClass(processed_class);\n\n\t\treblog_tree.find( \".reblog-list-item\" ).each(function( index ) {\n\t\t\tvar reblog_data = {\n\t\t\t\treblog_content: $(this).find('.reblog-content').html(),\n\t\t\t\treblog_author: $(this).find('.reblog-tumblelog-name').text(),\n\t\t\t\treblog_url: $(this).find('.reblog-tumblelog-name').attr('href')\n\t\t\t};\n\t\t\tall_quotes.push(reblog_data);\n\t\t});\n\t\tvar all_quotes_text = \"\";\n\t\tall_quotes.forEach(function(data, index, all) {\n\t\t\t//don't wrap if the previous user didn't add a comment\n\t\t\tif (data.reblog_content.indexOf(\"</blockquote>\", data.reblog_content.length - 13) !== -1) {\n\t\t\t\tall_quotes_text = data.reblog_content;\n\t\t\t} else {\n\t\t\t\tall_quotes_text = \"<p><a class='tumblr_blog' href='\" + data.reblog_url + \"'>\" + data.reblog_author + \"</a>:</p><blockquote>\" + all_quotes_text + data.reblog_content + \"</blockquote>\";\n\t\t\t}\t\t\n\t\t});\n\t\tvar old_content = XKit.interface.post_window.get_content_html();\n\t\tXKit.interface.post_window.set_content_html(all_quotes_text + old_content);\n\n\t\t$(\".btn-remove-trail .icon\").click();\n\t\t$(\".control-reblog-trail\").hide();\n\t},\n\tpost_window_legacy: function() {\n\t\tvar reblog_tree = $(\".reblog-tree\");\n\t\tif (reblog_tree.length <= 0) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Guard against double evaluation by marking the tree as processed\n\t\tvar processed_class = 'xkit-editable-reblogs-done';\n\t\tif (reblog_tree.hasClass(processed_class)) {\n\t\t\treturn;\n\t\t}\n\t\treblog_tree.addClass(processed_class);\n\n\t\t// Convert all of the user links to have class tumblr_blog\n\t\tvar top_quote_link = reblog_tree.find('p:first-child > a:first-child');\n\t\tvar quote_links = reblog_tree.find('blockquote > p:first-child > a:first-child');\n\n\t\tif (top_quote_link.length > 0) {\n\t\t\t$(top_quote_link[0]).addClass('tumblr_blog');\n\t\t}\n\t\tquote_links.each(function() {\n\t\t\t$(this).addClass('tumblr_blog');\n\t\t});\n\n\t\tvar reblog_content = reblog_tree.html();\n\n\t\tvar old_content = XKit.interface.post_window.get_content_html();\n\t\tXKit.interface.post_window.set_content_html(reblog_content + old_content);\n\n\t\t$(\".btn-remove-tree\").click();\n\t},\n\tdestroy: function() {\n\t\tthis.running = false;\n\t\tXKit.tools.remove_css(\"editable_reblogs_remove_content_tree\");\n\t\tXKit.interface.post_window_listener.remove(\"editable_reblogs\");\n\t}\n});\n","icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAA4VBMVEUAAAAAAQEBAgICBAQCBQYDBggEBwkHDRAHDhIIEBQIEBUJEhYKFhALFRoLFRsMGRUNGSAPIRgQHycYLzsYNScbNkMcNkQcN0UdOEYdOEceOkgfPUwfPU0gPk0gPk4gP08hQFAiQlMjTTgjTTkkTjktV20tWG4yYXoyYns4bIg7co9Bfp9Bj2lEhKZFhqdFh6lFh6pHiq1JjrJJj7NMlLpNlbtNlrtNlrxNl7pNl7tNmLpOmLlQpKpQpalRpqZRpqdRp6VSqaNSsoNTr5tTsJpTsZhTsZlUspdUsphWu4lWvIqrAtY3AAABFklEQVR42qXQa1OCQBiG4cdKOtn5bEmaZklaZi5v27kgi/3/PygY9l1g02Gm7m/wXMPsAippCpBlYCJLgGIxE6hPWQTfyooFA/W7txIQ+DZ4pCzeC4DyIJRkg/c80Ltodg14sf/ka7yfotLV4Inonmi0Pw9ua0DjPaBynoJ4/yI6gGn3Q7R6iWhoICeKqIqhuUbkLjmxaIgU+KGKAaD3BxV1Vr2Vhd5YpGfwA5UEKF3UrnnrQIuv+awYmL0f78n3p34hOqv1N3jXZwjyZ3AXvTXAFdcZIBlm4AZzy8l+u8kgFQZcAMlO22CQCgOOATQFPxpA5s3OyeWQaAbg/giqGOT2Kzg2qKNY3QajQwdZztEdg5L+D34AmZvHFbsM2NwAAAAASUVORK5CYII=\n","title":"Editable Reblogs","description":"Restores ability to edit previous reblogs of a post","developer":"new-xkit","version":"2.0.1","frame":"false","beta":"false","file":"found","server":"up","errors":false,"slow":"false"}